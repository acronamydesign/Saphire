var loadMainPackageJSON = require("./main-package.js"),
		buildSaphireRegistry = require("./build-registry.js"),
		saphireRegistry = buildSaphireRegistry(loadMainPackageJSON())

module.exports = function(selector, fn){
	if(typeof selector == "object"){

		var reg = saphireRegistry;
		var installed = arguments[0];
		var toExec = arguments[1];

		var i = 0;
		for(saphireModule in installed){
			var arg = installed[saphireModule];
			for(regex in arg){
				//business end of things
				arg[regex] = new RegExp(arg[regex])
				if(reg.toString().match(arg[regex])){
					var allTrue = true;
				}
				else{
					allTrue = false;
					console.log("A listed saphire module is not presently installed in your main package.json or a type error has occored.")
					break;
				}
			}
		}

		if(allTrue){

			for(fns in toExec["exec"]){
				var functionsToExec = toExec["exec"][fns]
				functionsToExec[0](functionsToExec[1])
			}

		}

	}
	//string check for shorthand
	else{

		if(saphireRegistry.indexOf(saphireRegistry).toString().match(selector)){
			return fn;
		}

	}



}
