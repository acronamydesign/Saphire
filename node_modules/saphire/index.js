//Master file
//This file is manditory but is not a core module, instead it allows for teamwork between other saphire modules.
var saphireGlobals = require("./globals.js"),
		loadMainPackageJSON = require("./models/main-package.js"),
		utils = require("./models/utils.js"),
		buildAdminMenu = require("./conditional/build-admin-menu.js"),
		cores = require("./models/core-definitions.js"),
		buildSaphireRegistry = require("./models/build-registry.js"),
		ifCoresExist = require("./models/check-cores.js"),
		saphireRegions = require('saphire-regions'),
		saphireThemes = require('saphire-themes');

//build the saphire registry to run multipurpose code if apropriate, use check cores function.
var saphireRegistry = buildSaphireRegistry(loadMainPackageJSON())


var saphire = {}

saphire.use = function(entry){
	return saphireRegions.use(entry);
	return saphireThemes.use(entry);
}

saphire.render = function(str){
	render = saphireRegions.render.bind(saphireRegions);
	return render(str)
}


//prepare conditional exports
var exportable = {}
var buildAdminMenu = buildAdminMenu.bind(exportable)


//Always export
exportable["functions"] = saphire;


ifCoresExist({
	installed:[
		"admin"
	]
},{
	exec:[
		[buildAdminMenu, saphireRegistry]
	]
});

module.exports = exportable;
