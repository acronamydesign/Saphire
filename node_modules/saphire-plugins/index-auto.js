var path = require("path");
//look at this file name for the presence of the word "auto" to determine the method of importing
fileName = process.argv[1].split("/").slice(-1).pop()

var settings = {
	autoIndex: true,
	pluginsDir:"/plugins",
	mode:{
		auto:{
			toIndex: __dirname,
		},
		manual:{
			find: ['home', 'about', 'contact'],
		}
	}
}

var selfTest = /auto/g.test(fileName)
if (selfTest && settings.autoIndex == null || selfTest && settings.autoIndex == true || settings.autoIndex == true) {
	var fs = require('fs'),
		files = fs.readdirSync(path.normalize(settings.mode.auto.toIndex+"/"+settings.pluginsDir)),
		//auto mode
		filterFiles = [] //get files in folder
		//get file names ignoring extention
	for (fi in files) {
		var matches = files[fi]//.match(/[^-_.]*/i)[0];
		//add to the filter list
		filterFiles[fi] = matches;
	}
	//remove this file from the filter list
	var self = filterFiles.indexOf("/index")
	if (self > -1) {
		filterFiles.splice(self, 1);
	}
	//use filtered files
	var pageCollection = filterFiles;
} else {
	//manual mode
	var pageCollection = settings.mode.manual.find;
}

//requre all pages by adding the pages to the array
var path = require("path"),
	p = -1,
	output = {}

for (plugin in pageCollection) {
	p++
	var location = __dirname,
		psudoExt = ".info"
		ext = ".js",
		wrapper = [],
		plugin = pageCollection[p]
	pageKey = plugin.replace("/", "");

	output[pageKey] = {
		path:path.normalize(location + settings.pluginsDir + "/" + plugin +"/"+ plugin + psudoExt + ext),
		status:1
	}
}

module.exports = output
